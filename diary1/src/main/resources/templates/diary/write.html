<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{fragments/layout}">
<!-- layout:decorate="~{fragments/layout}"  fragments폴더안에 layout 렌더링 -->
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div layout:fragment="content" class="container"
		style="margin-top: 5%; min-height: 500px">
		<h3>MULTIBOARD - 글쓰기</h3>
		<form th:action="@{/diary/insert}" method="post" id="writeForm"
			onsubmit="return form()">
			<fieldset>
				<legend>WRITE(CREATE)</legend>
				<div class="form-group">
					<label for="nickname">이름</label> <input type="text" name="nickname"
						id="nickname" class="form-control" th:value="${nickname}" readonly>
					<input type="hidden" name="username" id="username"
						class="form-control" th:value="${username}" readonly> <input
						type="hidden" name="email" id="email" class="form-control"
						th:value="${email}" readonly>
				</div>
				<div class="form-group">
					<label for="diary_title">제목</label> <input type="text"
						name="diary_title" id="diary_title" class="form-control">
				</div>
				<div class="form-group">
					<label for="diary_content">내용</label>
					<textarea name="diary_content" id="diary_content" cols="60"
						rows="10" class="form-control"></textarea>
				</div>
				<div class="from-group emoji">
					<label for="diary_emoji">요약</label> <input type="text"
						name="diary_emoji" id="diary_emoji" class="form-control"
						th:value="${emoji}">
				</div>

				<div class="mt-3 mb-3 form-group text-right">
					<input type="submit" value="입력" class="btn btn-default"
						style="color: white; background-color: #f4511e"> <input
						type="reset" value="취소" class="btn btn-info text-white"> <a
						th:href="@{/diary/list}" class="btn btn-info text-white">목록보기</a>
				</div>
			</fieldset>
		</form>
		<!-- end form -->
		<script>
			function form() {
				let diary_title = document.getElementById("diary_title");
				let diary_content = document.getElementById("diary_content");
			
				if (diary_title.value == "") {
					alert("빈칸입니다.");
					diary_title.focus();
					return false;
				}
				if (diary_content.value == "") {
					alert("빈칸입니다.");
					diary_content.focus();
					return false;
				}
			}
			$(function(){
				getEmoji('오늘의 일기');
				$(".emoji").hide();
				$("#diary_content").on("keyup", function(){ // 키보드 누를 때
					$(".emoji").fadeIn();		
					let searchQuery = $(this).val().trim(); // 입력값 공백없이
					if(searchQuery.length > 0){ // 검색어가 공백이 아닐 때 호출
						$(".emoji").fadeIn();
						getEmoji(searchQuery);
					}
				})
			});
			function getEmoji(diary_content) {
				$.ajax({
					url:"/diary/write/" + diary_content,
					type:"POST",
					dataType:"json",
					contentType:"application/json;charset=UTF-8",
					error:function(zhr, status, msg){ 
						alert(status+"/"+msg)
						},
					success:function(json){
						console.log(json);
						$(".emoji").empty();
						if(json && json.items && json.items.length >0 ){
							let emoji = json.content;
							let row = `
								<label for="diary_emoji">요약</label> 
								<input type="text"
								name="diary_emoji" id="diary_emoji" class="form-control"
								th:value="${emoji}">
							`
							$(".emoji").append(row);
						} else {
							console.log("empty");
						}// E if
					}
				});
			}
		</script>
	</div>
</body>
</html>